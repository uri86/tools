#!/bin/bash

# === Resolve script paths ===
SCRIPT_DIR="$(cd "$(dirname "$(readlink "$0" || echo "$0")")" && pwd)"
SCRIPT_NAME="$SCRIPT_DIR/clipulse.py"
VENV_DIR="$SCRIPT_DIR/.venv"
REQUIREMENTS=("requests" "pyperclip")

# === Create virtual environment (first time only) ===
if [ ! -d "$VENV_DIR" ]; then
    echo "üîß Creating virtual environment..."
    python3 -m venv "$VENV_DIR" || { echo "‚ùå Failed to create venv"; exit 1; }

    # Activate venv
    source "$VENV_DIR/bin/activate" || { echo "‚ùå Failed to activate venv"; exit 1; }

    pip install --quiet "${REQUIREMENTS[@]}"
else
    # Just activate existing venv
    source "$VENV_DIR/bin/activate" || { echo "‚ùå Failed to activate venv"; exit 1; }
fi

# === Run the Python script ===
python "$SCRIPT_NAME" "$@"
